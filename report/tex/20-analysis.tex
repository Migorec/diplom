\chapter{Аналитический раздел}
\label{cha:analysis}

В данном разделе проводится обзор принципов функционирования и синтаксиса системы GPSS, а также производтся выбор блоков, которые следует реализовать в разрабатываемой системе моделирования.

\section{Краткий обзор GPSS}

GPSS стал одним из первых языков моделирования, облегчающих процесс написания имитационных программ. Он был создан в виде конечного продукта Джефри Гордоном в фирме IBM в 1962~г.\cite{ImitGPSS} В свое время он входил в десятку лучших языков программирования и по сей день широко используется для решения практических задач.

Основой имитационных алгоритмов GPSS является дискретно-событийный подход~--- моделирование сис­темы в дискретные моменты времени, когда происходят события, от­ражающие последовательность изменения состояний системы во времени.\cite{ImitGPSS}

\section{Объекты языка GPSS}

Основными Объектами языка GPSS являются транзакты и блоки, которые отображают соответственно динамические и статические объекты моделируемой системы.

Транзакты~--- динамические элементы GPSS-модели. В реальной системе транзактам могут соответствовать такие элементы как заявка, покупатель автомобиль и др. Состояни транзакта в процессе моделирования хараактеризуется следующими атрибутами:

\begin{itemize}
\item параметры~--- набор значений связанных с транзактом. Каждый транзакт может иметь произвольное число параметров. Каждый параметр иметт уникальный номер, по которому на него можно сослаться;
\item приоритет~--- определяет порядок продвижения транзактов при конкурировании за общий ресурс;
\item текущий блок~--- номер блока, в котором транзакт находится в данный момент;
\item следующий блок~--- номер блока, в который транзакт попыытается войти;
\item время появления блока~---  момент времени в который транзакт был создан;
\item состояние~--- состояние, показывающее в каких списках транзакт находится в даннный момент. Транзакт может находиться в одном из следующих состояний:
    \begin{enumerate}
    \item активен~--- транзакт находится в списке текущих событий и имеет наивысший приоритет;
    \item приостановлен~--- транзакт находится в списке будущих событий либо в списке текущих событий, но с меньшим приоритетом;
    \item пассивен~--- транзакт находится в списке прерываний, списке синхронизации, списке блокировок или списке пользователя;
    \item завершен~--- транзакт уничтожен и болше не участвует в модели.
    \end{enumerate}
    Диаграмма состояний транзакта показана на Рисунке~\ref{fig:transactionState}.
\end{itemize}


\begin{figure}[ht]
  \centering
  \includegraphics[width=\textwidth]{inc/dia/transactionState}
  \caption{Состояния транзакта}
  \label{fig:transactionState}
\end{figure}


Блоки~--- статические элементы GPSS-модели. Модель в GPSS может быть представленна как диаграмма блоков, т.е. ориентированный граф, узлами которого являются блоки, а дугам~--- направления движения транзактов. с каждым блоком связано некоторое действие, изменяющее состояние прочих элементов модели. Транзакты проходят блоки один за другим, до тех пор пока не достигнут блока TERMINATE. В ряде случаев транзакт может быть остановлен в одном из блоков до наступления некоторого события.


Помимо транзактов и блоков в GPSS используются следующие объекты: устройства, многоканальные устройства (хранилища, памяти), ключи, очереди, списки пользователя и др.


\section{Управления процесом моделирования в GPSS}

В системе GPSS итерпретатор поддерживает сложные структуры организации списков (см. Рисунок~\ref{fig:GPSSChains}).\cite{ImitGPSS} Два основных из них~--- список текущих событий (СТС) и список будущих событий (СБС).

\begin{figure}[ht]
  \centering
  \includegraphics[width=\textwidth]{inc/dia/gpss}
  \caption{Списки GPSS}
  \label{fig:GPSSChains}
\end{figure}

В СТС входят все события запланированные  на текущий  момент модельного времени. Интерпретатор в первую очередь просматривает этот список и перемещает по модели те транзакты, для которых выполнены все условия. Если таких транзактов в списке не оказалось интерпретатор обращается к СБС. Он переносит все события, запланированные на ближайший момент времени и вновь возвращается к просмотру СТС. Перенос также осуществляется в случае совпадения текущего момента времени с моментом наступления ближайшего события из СБС.

В целях эффективной организации просмотра транзактов, движение которых заблокировано (например, из-за занятости некоторого ресурса), используются следующие вспомогательные списки:

\begin{itemize}
\item списки блокировок~--- списки транзактов, которые ожидают освобождения некоторого ресурса;
\item список прерываний~--- содержит транзакты, прерванные во время обслуживания. Используется для организации обслуживания одноканальных устройств с абсолютным приоритетом;
\item списки синхронизации~--- содержат транзакты одного семейства (созданные блоком SPLIT), которые ожидают синхронизации в блоках (MATCH, ASSEMBLE или GATHER);
\item списки пользователя~--- содержат транзакты, выведенные пользователем из СТС с помощью блока LINK. Транзакты могут быть возвращены в СТСс помощью блока UNLINK.
\end{itemize}




\section{Выбор подмножества реализуемых блоков}

В современной версии языка GPSS (входящей в пакет GPSS World) поддерживается 53 различных блока.\cite{GPSSRef} В рамках данной работы не представляется возможным реализовать  аналоги каждого из них. Поэтому следует выделить некоторое подмножество блоков, которое с одной не будет слишком обширным, а с другой~--- позволит решать практические или по крайней мере учебные задачи.

В качетсве примера рассмотрим задачу из курса Модели оценки качества аппаратно программных комлексов:

\begin{quote}
В вычислительной системе, содержащей N процессоров и M каналов обмена данными, постоянно находятся K задач. Разработать модель, оценивающую производительность системы с учетом отказов и восстановлений процессоров и каналов. Имеется не более L ремонтных бригад, которые ремонтируют отказывающие устройства с бесприоритетной  дисциплиной. Интенсивность отказов, восстановлений, средние времена обработки сообщения и среднее время обдумывания также известны.
\end{quote}

Как и подаляющее большинство других задач, данная задача, безусловно, не может быть решена без использования блоков GENERATE, TERMINATE и ADVANCE. Так как моделируемая система является замкнутой, при описании модели не обойтись без блока TRANSFER.

К содалению, не представляется возможным реализовать процессоры и каналы как многоканальные устройства, т.к. многоканальные устройства в GPSS не поддерживают абсолютные приоритеты и не позволяют смоделировать выход из строя отдельных каналов устройства. Однако, требуемую систему можно описать при помощи множества одноканальных устройств и блока TRANSFER в режиме ALL. Таким образом, также понадобятся блоки SEIZE и RELEASE. Для моделирования отказов устройств можно воспользоваться блоками SAVAIL и SUNAVAIL либо блоками PREEMPT и RETURN.

Наконец, доступные ремонтные бригады можно смоделировать с помощью многоканального устройства. Соответственно, понадобятся блоки ENTER и LEAVE.

Приблизительная модель системы показана в Листинге~\ref{lst:sample01}

\lstinputlisting[caption=Приблизительная модель системы,label=lst:sample01]{inc/src/analysModel.gpss}

Таким образом, разрабатываемая система имитационного моделирования должна поддерживать аналоги по крайней мере следующих блоков: ADVANCE, ENTER, GENERATE, LEAVE, PREEMPT, RELEASE, RETURN, SEIZE, TERMINATE и TRANSFER.

\section{Описание выбранных блоков}

Ниже представлено описание выбранных блоков в соответствии со справочным руководством GPSS World.\cite{GPSSRef}

\subsection*{ADVANCE A,B}

Блок ADVANCE осуществляет задержку продвижения транзактов на заданный промежуток времени.

A~--- Среднее время задержки. Не обязательный параметр. Значение по умолчанию~---~0.

B~--- Максимально допустимое отклонение времени задержки либо функция-модификатор.

\subsection*{ENTER A,B}

При входе в блок ENTER транзакт либо занимает заданное колличество каналов указанного многоканального устройства либо блокируется до его освобождения.

A~--- Имя или номер многоканального устройства. Обязательный параметр.

B~--- Число требуемых каналов. Не обязательный параметр. Значение по умолчанию~--- 1.

\subsection*{GENERATE A,B,C,D,E}

Блок GENERATE предназначен для создания новых транзактов.

A~--- Среднее время между генерацией последовательных заявок. Не обязательный параметр.

B~--- Максимальное допустимое отклонение времени генерации либо функция-модификатор. Не обязательный параметр.

С~--- Задержка до начала генерации первого транзакта. Не обязательный параметр.

D~--- Ограничение на максимальное допустимое число созданных транзактов. Не обязательный параметр. Пол умолчанию ограничение отсутствует.

E~--- Уровень приоритета создаваемых заявок. Не обязательный параметр. Значение по умолчанию~--- 0.

\subsection*{LEAVE A,B}

При входе в блок LEAVE транзакт освобождаает заданное число каналов указанного многоканального устройства.

A~--- Имя или номер многоканального устройства. Обязательный параметр.

B~--- Число требуемых каналов. Не обязательный параметр. Значение по умолчанию~--- 1.

\subsection*{PREEMPT A,B,C,D,E}

\subsection*{RELEASE A}

Блок RELEASE освобождает одноканальное устройство.

A~--- Имя или номер одноканального устройства. Обязательный параметр.

\subsection*{RETURN A}

Блок RELEASE освобождает одноканальное устройство.

A~--- Имя или номер одноканального устройства. Обязательный параметр.

\subsection*{SEIZE A}

При входе в блок SEIZE транзакт занимает указанное одноканальное устройство либо блокируется до его освобождения.

A~--- Имя или номер одноканального устройства. Обязательный параметр.

\subsection*{TERMINATE A}

Блок TERMINATE завершает поступивший в него транзакт. И опционально уменьшает счетчик завершенных транзаков. Когда счетчик достигает нуля имитация останавливается.

A~--- Значение, на которое следует уменьшить счетчик завершенных транзактов. Не обязательный параметр. Значение по умолчанию~--- 0.

\section{Выводы}

Был проведен анализ устройства системы GPSS и осуществлен выбор подмножества блоков, необходимых для моделирования не сложных систем массового обслуживания.
